'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Client = undefined;

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _request = require('request');

var _request2 = _interopRequireDefault(_request);

var _oAuthHelper = require('./oAuthHelper');

var _catalogItem = require('./catalogItem/catalogItem');

var _priceGuide = require('./catalogItem/priceGuide');

var _knownColor = require('./catalogItem/knownColor');

var _itemImage = require('./catalogItem/itemImage');

var _subsets = require('./catalogItem/subsets');

var _supersets = require('./catalogItem/supersets');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * Create a client to perform
 */
var Client = exports.Client = function () {
  /**
   * Create an instance of the Bricklin Node Client.
   * @param {object} options Options that are used to create a new client.
   * @param {string} [options.token] The `TokenValue` from {@link https://www.bricklink.com/v2/api/register_consumer.page}
   * @param {string} [options.token_secret] The `TokenSecret` from {@link https://www.bricklink.com/v2/api/register_consumer.page}
   * @param {string} [options.consumer_key] The `ConsumerKey` from {@link https://www.bricklink.com/v2/api/register_consumer.page}
   * @param {string} [options.consumer_secret] The `ConsumerSecret` from {@link https://www.bricklink.com/v2/api/register_consumer.page}
   * @param {string} [options.endpoint='https://api.bricklink.com/api/store/v1/'] The url of the Bricklink API.
   * @param {Agent} [options.agent=null] An Http(s) agent for proxy, etc.
   */
  function Client(options) {
    _classCallCheck(this, Client);

    options = options || {};

    /** @type {string} */
    this.token = options.token || '';
    /** @type {string} */
    this.token_secret = options.token_secret || '';
    /** @type {string} */
    this.consumer_key = options.consumer_key || '';
    /** @type {string} */
    this.consumer_secret = options.consumer_secret || '';
    /** @type {string} */
    this.endpoint = options.endpoint || 'https://api.bricklink.com/api/store/v1/';
    /** @type {Agent} */
    this.agent = options.agent || null;
  }

  /**
   * Performs a bricklink request and the callback upon success.
   * @param {Request} req The request to perform.
   * @return {Promise} The data that has been return from the API request and any callbacks.
   */


  _createClass(Client, [{
    key: 'send',
    value: function send(req) {
      var init = {
        uri: this.endpoint + req.uri.replace(/^\//, '') + req.params.toQueryString(),
        method: req.method,
        headers: {}
      };

      var oauthHelper = new _oAuthHelper.OAuthHelper(this.consumer_key, this.token);
      oauthHelper.sign(init.uri, req, this.consumer_secret, this.token_secret);

      if (this.agent) {
        init['agent'] = this.agent;
      }

      init.headers['authorization'] = oauthHelper.header;

      var promise = new Promise(function (resolve, reject) {
        (0, _request2.default)(init, function (er, rep, body) {
          if (er) {
            reject(er);
          }
          var data = JSON.parse(body);
          if (data.meta.code >= 300) {
            console.error(init.uri);
            console.error(data.meta);
          }
          resolve(data.data);
        });
      });

      if (req.callback) {
        promise.then(req.callback);
      }
      return promise;
    }

    /**
     * Get a catalog item by type and identification number.
     * @param {string} itemType An item type as can be foud at {@link ItemType}.
     * @param {string} itemNumber An item identification number.
     * @return {Promise<CatalogItem>} A promise that resolves to a catalog item.
     */

  }, {
    key: 'getCatalogItem',
    value: function getCatalogItem(itemType, itemNumber) {
      var req = _catalogItem.CatalogItem.get(itemType, itemNumber);

      return this.send(req);
    }

    /**
     * Get the price guide for a given catalog item.
     * @param {string} itemType An item type as can be foud at {@link ItemType}.
     * @param {string} itemNumber An item identification number.
     * @param {object} params Options for the price guide as outlined in {@link PriceGuideOptions}.
     * @return {Promise<PriceGuide>} A promise that resolves to a price guide.
     */

  }, {
    key: 'getPriceGuide',
    value: function getPriceGuide(itemType, itemNumber, params) {
      var req = _priceGuide.PriceGuide.get(itemType, itemNumber, params);

      return this.send(req);
    }

    /**
     * Get known colors for a catalog item.
     * @param {string} itemType An item type as can be foud at {@link ItemType}.
     * @param {string} itemNumber An item identification number.
     * @return {Promise<Array>} A promise that resolves to a list of {@link KnownColor}.
     */

  }, {
    key: 'getKnownColors',
    value: function getKnownColors(itemType, itemNumber) {
      var req = _knownColor.KnownColor.get(itemType, itemNumber);

      return this.send(req);
    }

    /**
     * Can get an image for a specific image color of a known catalog item.
     * @param {string} itemType An item type as can be foud at {@link ItemType}.
     * @param {string} itemNumber An item identification number.
     * @param {number} colorId The color id of the item.
     * @return {Promise<ItemImage>} A promise that resolves to an Item Image.
     */

  }, {
    key: 'getItemImage',
    value: function getItemImage(itemType, itemNumber, colorId) {
      var req = _itemImage.ItemImage.get(itemType, itemNumber, colorId);
      return this.send(req);
    }

    /**
     * Gets a subset of a catalog item.
     * @param {string} itemType An item type as can be foud at {@link ItemType}.
     * @param {string} itemNumber An item identification number.
     * @param {object} [params] Options for the price guide as outlined in {@link SubsetOptions}.
     * @return {Promise<Array>} A promise that resolves to a  list of {@link Subset}.
     */

  }, {
    key: 'getItemSubset',
    value: function getItemSubset(itemType, itemNumber, params) {
      var req = _subsets.Subset.get(itemType, itemNumber, params);
      return this.send(req);
    }

    /**
     * Gets a superset of a catalog item.
     * @param {string} itemType An item type as can be foud at {@link ItemType}.
     * @param {string} itemNumber An item identification number.
     * @param {object} [params] Options for the price guide as outlined in {@link SupersetOptions}.
     * @return {Promise<Array>} A promise that resolves to a  list of {@link Superset}.
     */

  }, {
    key: 'getItemSuperset',
    value: function getItemSuperset(itemType, itemNumber, params) {
      var req = _supersets.Superset.get(itemType, itemNumber, params);
      return this.send(req);
    }
  }]);

  return Client;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGllbnQuanMiXSwibmFtZXMiOlsiQ2xpZW50Iiwib3B0aW9ucyIsInRva2VuIiwidG9rZW5fc2VjcmV0IiwiY29uc3VtZXJfa2V5IiwiY29uc3VtZXJfc2VjcmV0IiwiZW5kcG9pbnQiLCJhZ2VudCIsInJlcSIsImluaXQiLCJ1cmkiLCJyZXBsYWNlIiwicGFyYW1zIiwidG9RdWVyeVN0cmluZyIsIm1ldGhvZCIsImhlYWRlcnMiLCJvYXV0aEhlbHBlciIsInNpZ24iLCJoZWFkZXIiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlciIsInJlcCIsImJvZHkiLCJkYXRhIiwiSlNPTiIsInBhcnNlIiwibWV0YSIsImNvZGUiLCJjb25zb2xlIiwiZXJyb3IiLCJjYWxsYmFjayIsInRoZW4iLCJpdGVtVHlwZSIsIml0ZW1OdW1iZXIiLCJnZXQiLCJzZW5kIiwiY29sb3JJZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUE7OztJQUdhQSxNLFdBQUFBLE07QUFDWDs7Ozs7Ozs7OztBQVVBLGtCQUFZQyxPQUFaLEVBQW9CO0FBQUE7O0FBQ2xCQSxjQUFVQSxXQUFXLEVBQXJCOztBQUVBO0FBQ0EsU0FBS0MsS0FBTCxHQUFhRCxRQUFRQyxLQUFSLElBQWlCLEVBQTlCO0FBQ0E7QUFDQSxTQUFLQyxZQUFMLEdBQW9CRixRQUFRRSxZQUFSLElBQXdCLEVBQTVDO0FBQ0E7QUFDQSxTQUFLQyxZQUFMLEdBQW9CSCxRQUFRRyxZQUFSLElBQXdCLEVBQTVDO0FBQ0E7QUFDQSxTQUFLQyxlQUFMLEdBQXVCSixRQUFRSSxlQUFSLElBQTJCLEVBQWxEO0FBQ0E7QUFDQSxTQUFLQyxRQUFMLEdBQWdCTCxRQUFRSyxRQUFSLElBQW9CLHlDQUFwQztBQUNBO0FBQ0EsU0FBS0MsS0FBTCxHQUFhTixRQUFRTSxLQUFSLElBQWlCLElBQTlCO0FB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NkIsR0FBVCxDQUFhRixRQUFiLEVBQXVCQyxVQUF2QixFQUFtQ3hCLE1BQW5DLENBQVY7QUFDQSxhQUFPLEtBQUswQixJQUFMLENBQVU5QixHQUFWLENBQVA7QUFDRCIsImZpbGUiOiJjbGllbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVxdWVzdCBmcm9tICdyZXF1ZXN0JztcblxuaW1wb3J0IHtPQXV0aEhlbHBlcn0gZnJvbSAnLi9vQXV0aEhlbHBlcic7XG5pbXBvcnQge0NhdGFsb2dJdGVtfSBmcm9tICcuL2NhdGFsb2dJdGVtL2NhdGFsb2dJdGVtJztcbmltcG9ydCB7UHJpY2VHdWlkZX0gZnJvbSAnLi9jYXRhbG9nSXRlbS9wcmljZUd1aWRlJztcbmltcG9ydCB7S25vd25Db2xvcn0gZnJvbSAnLi9jYXRhbG9nSXRlbS9rbm93bkNvbG9yJztcbmltcG9ydCB7SXRlbUltYWdlfSBmcm9tICcuL2NhdGFsb2dJdGVtL2l0ZW1JbWFnZSc7XG5pbXBvcnQge1N1YnNldH0gZnJvbSAnLi9jYXRhbG9nSXRlbS9zdWJzZXRzJztcbmltcG9ydCB7U3VwZXJzZXR9IGZyb20gJy4vY2F0YWxvZ0l0ZW0vc3VwZXJzZXRzJztcblxuLyoqXG4gKiBDcmVhdGUgYSBjbGllbnQgdG8gcGVyZm9ybVxuICovXG5leHBvcnQgY2xhc3MgQ2xpZW50IHtcbiAgLyoqXG4gICAqIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGUgQnJpY2tsaW4gTm9kZSBDbGllbnQuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIE9wdGlvbnMgdGhhdCBhcmUgdXNlZCB0byBjcmVhdGUgYSBuZXcgY2xpZW50LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gW29wdGlvbnMudG9rZW5dIFRoZSBgVG9rZW5WYWx1ZWAgZnJvbSB7QGxpbmsgaHR0cHM6Ly93d3cuYnJpY2tsaW5rLmNvbS92Mi9hcGkvcmVnaXN0ZXJfY29uc3VtZXIucGFnZX1cbiAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLnRva2VuX3NlY3JldF0gVGhlIGBUb2tlblNlY3JldGAgZnJvbSB7QGxpbmsgaHR0cHM6Ly93d3cuYnJpY2tsaW5rLmNvbS92Mi9hcGkvcmVnaXN0ZXJfY29uc3VtZXIucGFnZX1cbiAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmNvbnN1bWVyX2tleV0gVGhlIGBDb25zdW1lcktleWAgZnJvbSB7QGxpbmsgaHR0cHM6Ly93d3cuYnJpY2tsaW5rLmNvbS92Mi9hcGkvcmVnaXN0ZXJfY29uc3VtZXIucGFnZX1cbiAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmNvbnN1bWVyX3NlY3JldF0gVGhlIGBDb25zdW1lclNlY3JldGAgZnJvbSB7QGxpbmsgaHR0cHM6Ly93d3cuYnJpY2tsaW5rLmNvbS92Mi9hcGkvcmVnaXN0ZXJfY29uc3VtZXIucGFnZX1cbiAgICogQHBhcmFtIHtzdHJpbmd9IFtvcHRpb25zLmVuZHBvaW50PSdodHRwczovL2FwaS5icmlja2xpbmsuY29tL2FwaS9zdG9yZS92MS8nXSBUaGUgdXJsIG9mIHRoZSBCcmlja2xpbmsgQVBJLlxuICAgKiBAcGFyYW0ge0FnZW50fSBbb3B0aW9ucy5hZ2VudD1udWxsXSBBbiBIdHRwKHMpIGFnZW50IGZvciBwcm94eSwgZXRjLlxuICAgKi9cbiAgY29uc3RydWN0b3Iob3B0aW9ucyl7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICAvKiogQHR5cGUge3N0cmluZ30gKi9cbiAgICB0aGlzLnRva2VuID0gb3B0aW9ucy50b2tlbiB8fCAnJztcbiAgICAvKiogQHR5cGUge3N0cmluZ30gKi9cbiAgICB0aGlzLnRva2VuX3NlY3JldCA9IG9wdGlvbnMudG9rZW5fc2VjcmV0IHx8ICcnO1xuICAgIC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xuICAgIHRoaXMuY29uc3VtZXJfa2V5ID0gb3B0aW9ucy5jb25zdW1lcl9rZXkgfHwgJyc7XG4gICAgLyoqIEB0eXBlIHtzdHJpbmd9ICovXG4gICAgdGhpcy5jb25zdW1lcl9zZWNyZXQgPSBvcHRpb25zLmNvbnN1bWVyX3NlY3JldCB8fCAnJztcbiAgICAvKiogQHR5cGUge3N0cmluZ30gKi9cbiAgICB0aGlzLmVuZHBvaW50ID0gb3B0aW9ucy5lbmRwb2ludCB8fCAnaHR0cHM6Ly9hcGkuYnJpY2tsaW5rLmNvbS9hcGkvc3RvcmUvdjEvJztcbiAgICAvKiogQHR5cGUge0FnZW50fSAqL1xuICAgIHRoaXMuYWdlbnQgPSBvcHRpb25zLmFnZW50IHx8IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybXMgYSBicmlja2xpbmsgcmVxdWVzdCBhbmQgdGhlIGNhbGxiYWNrIHVwb24gc3VjY2Vzcy5cbiAgICogQHBhcmFtIHtSZXF1ZXN0fSByZXEgVGhlIHJlcXVlc3QgdG8gcGVyZm9ybS5cbiAgICogQHJldHVybiB7UHJvbWlzZX0gVGhlIGRhdGEgdGhhdCBoYXMgYmVlbiByZXR1cm4gZnJvbSB0aGUgQVBJIHJlcXVlc3QgYW5kIGFueSBjYWxsYmFja3MuXG4gICAqL1xuICBzZW5kKHJlcSkge1xuICAgIGxldCBpbml0ID0ge1xuICAgICAgdXJpOiB0aGlzLmVuZHBvaW50ICsgcmVxLnVyaS5yZXBsYWNlKC9eXFwvLywnJykgKyByZXEucGFyYW1zLnRvUXVlcnlTdHJpbmcoKSxcbiAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcbiAgICAgIGhlYWRlcnM6IHt9XG4gICAgfVxuXG4gICAgbGV0IG9hdXRoSGVscGVyID0gbmV3IE9BdXRoSGVscGVyKHRoaXMuY29uc3VtZXJfa2V5LCB0aGlzLnRva2VuKTtcbiAgICBvYXV0aEhlbHBlci5zaWduKGluaXQudXJpLCByZXEsIHRoaXMuY29uc3VtZXJfc2VjcmV0LCB0aGlzLnRva2VuX3NlY3JldCk7XG5cbiAgICBpZih0aGlzLmFnZW50KXtcbiAgICAgIGluaXRbJ2FnZW50J10gPSB0aGlzLmFnZW50O1xuICAgIH1cblxuICAgIGluaXQuaGVhZGVyc1snYXV0aG9yaXphdGlvbiddID0gb2F1dGhIZWxwZXIuaGVhZGVyO1xuXG4gICAgbGV0IHByb21pc2UgPSBuZXcgUHJvbWlzZSggKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgcmVxdWVzdChpbml0LCAoZXIsIHJlcCwgYm9keSkgPT4ge1xuICAgICAgICBpZihlcil7XG4gICAgICAgICAgcmVqZWN0KGVyKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoYm9keSk7XG4gICAgICAgIGlmKGRhdGEubWV0YS5jb2RlID49IDMwMCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoaW5pdC51cmkpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZGF0YS5tZXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKGRhdGEuZGF0YSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGlmKHJlcS5jYWxsYmFjayl7XG4gICAgICBwcm9taXNlLnRoZW4ocmVxLmNhbGxiYWNrKTtcbiAgICB9XG4gICAgcmV0dXJuIHByb21pc2U7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgY2F0YWxvZyBpdGVtIGJ5IHR5cGUgYW5kIGlkZW50aWZpY2F0aW9uIG51bWJlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1UeXBlIEFuIGl0ZW0gdHlwZSBhcyBjYW4gYmUgZm91ZCBhdCB7QGxpbmsgSXRlbVR5cGV9LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbU51bWJlciBBbiBpdGVtIGlkZW50aWZpY2F0aW9uIG51bWJlci5cbiAgICogQHJldHVybiB7UHJvbWlzZTxDYXRhbG9nSXRlbT59IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGEgY2F0YWxvZyBpdGVtLlxuICAgKi9cbiAgZ2V0Q2F0YWxvZ0l0ZW0oaXRlbVR5cGUsIGl0ZW1OdW1iZXIpIHtcbiAgICBsZXQgcmVxID0gQ2F0YWxvZ0l0ZW0uZ2V0KGl0ZW1UeXBlLCBpdGVtTnVtYmVyKTtcblxuICAgIHJldHVybiB0aGlzLnNlbmQocmVxKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHByaWNlIGd1aWRlIGZvciBhIGdpdmVuIGNhdGFsb2cgaXRlbS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1UeXBlIEFuIGl0ZW0gdHlwZSBhcyBjYW4gYmUgZm91ZCBhdCB7QGxpbmsgSXRlbVR5cGV9LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbU51bWJlciBBbiBpdGVtIGlkZW50aWZpY2F0aW9uIG51bWJlci5cbiAgICogQHBhcmFtIHtvYmplY3R9IHBhcmFtcyBPcHRpb25zIGZvciB0aGUgcHJpY2UgZ3VpZGUgYXMgb3V0bGluZWQgaW4ge0BsaW5rIFByaWNlR3VpZGVPcHRpb25zfS5cbiAgICogQHJldHVybiB7UHJvbWlzZTxQcmljZUd1aWRlPn0gQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYSBwcmljZSBndWlkZS5cbiAgICovXG4gIGdldFByaWNlR3VpZGUoaXRlbVR5cGUsIGl0ZW1OdW1iZXIsIHBhcmFtcykge1xuICAgIGxldCByZXEgPSBQcmljZUd1aWRlLmdldChpdGVtVHlwZSwgaXRlbU51bWJlciwgcGFyYW1zKTtcblxuICAgIHJldHVybiB0aGlzLnNlbmQocmVxKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQga25vd24gY29sb3JzIGZvciBhIGNhdGFsb2cgaXRlbS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1UeXBlIEFuIGl0ZW0gdHlwZSBhcyBjYW4gYmUgZm91ZCBhdCB7QGxpbmsgSXRlbVR5cGV9LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbU51bWJlciBBbiBpdGVtIGlkZW50aWZpY2F0aW9uIG51bWJlci5cbiAgICogQHJldHVybiB7UHJvbWlzZTxBcnJheT59IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGEgbGlzdCBvZiB7QGxpbmsgS25vd25Db2xvcn0uXG4gICAqL1xuICBnZXRLbm93bkNvbG9ycyhpdGVtVHlwZSwgaXRlbU51bWJlcikge1xuICAgIGxldCByZXEgPSBLbm93bkNvbG9yLmdldChpdGVtVHlwZSwgaXRlbU51bWJlcik7XG5cbiAgICByZXR1cm4gdGhpcy5zZW5kKHJlcSk7XG4gIH1cblxuICAvKipcbiAgICogQ2FuIGdldCBhbiBpbWFnZSBmb3IgYSBzcGVjaWZpYyBpbWFnZSBjb2xvciBvZiBhIGtub3duIGNhdGFsb2cgaXRlbS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1UeXBlIEFuIGl0ZW0gdHlwZSBhcyBjYW4gYmUgZm91ZCBhdCB7QGxpbmsgSXRlbVR5cGV9LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaXRlbU51bWJlciBBbiBpdGVtIGlkZW50aWZpY2F0aW9uIG51bWJlci5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGNvbG9ySWQgVGhlIGNvbG9yIGlkIG9mIHRoZSBpdGVtLlxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEl0ZW1JbWFnZT59IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIGFuIEl0ZW0gSW1hZ2UuXG4gICAqL1xuICBnZXRJdGVtSW1hZ2UoaXRlbVR5cGUsIGl0ZW1OdW1iZXIsIGNvbG9ySWQpIHtcbiAgICBsZXQgcmVxID0gSXRlbUltYWdlLmdldChpdGVtVHlwZSwgaXRlbU51bWJlciwgY29sb3JJZCk7XG4gICAgcmV0dXJuIHRoaXMuc2VuZChyZXEpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYSBzdWJzZXQgb2YgYSBjYXRhbG9nIGl0ZW0uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpdGVtVHlwZSBBbiBpdGVtIHR5cGUgYXMgY2FuIGJlIGZvdWQgYXQge0BsaW5rIEl0ZW1UeXBlfS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1OdW1iZXIgQW4gaXRlbSBpZGVudGlmaWNhdGlvbiBudW1iZXIuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbcGFyYW1zXSBPcHRpb25zIGZvciB0aGUgcHJpY2UgZ3VpZGUgYXMgb3V0bGluZWQgaW4ge0BsaW5rIFN1YnNldE9wdGlvbnN9LlxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEFycmF5Pn0gQSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgdG8gYSAgbGlzdCBvZiB7QGxpbmsgU3Vic2V0fS5cbiAgICovXG4gIGdldEl0ZW1TdWJzZXQoaXRlbVR5cGUsIGl0ZW1OdW1iZXIsIHBhcmFtcykge1xuICAgIGxldCByZXEgPSBTdWJzZXQuZ2V0KGl0ZW1UeXBlLCBpdGVtTnVtYmVyLCBwYXJhbXMpO1xuICAgIHJldHVybiB0aGlzLnNlbmQocmVxKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGEgc3VwZXJzZXQgb2YgYSBjYXRhbG9nIGl0ZW0uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpdGVtVHlwZSBBbiBpdGVtIHR5cGUgYXMgY2FuIGJlIGZvdWQgYXQge0BsaW5rIEl0ZW1UeXBlfS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1OdW1iZXIgQW4gaXRlbSBpZGVudGlmaWNhdGlvbiBudW1iZXIuXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBbcGFyYW1zXSBPcHRpb25zIGZvciB0aGUgcHJpY2UgZ3VpZGUgYXMgb3V0bGluZWQgaW4ge0BsaW5rIFN1cGVyc2V0T3B0aW9uc30uXG4gICAqIEByZXR1cm4ge1Byb21pc2U8QXJyYXk+fSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byBhICBsaXN0IG9mIHtAbGluayBTdXBlcnNldH0uXG4gICAqL1xuICBnZXRJdGVtU3VwZXJzZXQoaXRlbVR5cGUsIGl0ZW1OdW1iZXIsIHBhcmFtcykge1xuICAgIGxldCByZXEgPSBTdXBlcnNldC5nZXQoaXRlbVR5cGUsIGl0ZW1OdW1iZXIsIHBhcmFtcyk7XG4gICAgcmV0dXJuIHRoaXMuc2VuZChyZXEpO1xuICB9XG59XG4iXX0=